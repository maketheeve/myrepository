<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Event Booking</title>
    <script src="https://checkout.razorpay.com/v1/checkout.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary-color: #6366f1;
            --secondary-color: #a855f7;
            --text-color: #4a5568;
            --card-bg: #fff;
            --card-shadow: rgba(0, 0, 0, 0.1);
            --border-color: #e2e8f0;
        }

        body {
            font-family: 'Poppins', sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 1rem;
            margin: 0;
            line-height: 1.5;
        }

        .container {
            max-width: 28rem;
            width: 100%;
            background: linear-gradient(145deg, var(--card-bg), #f8f9fa);
            border-radius: 1.5rem;
            box-shadow: 0 20px 25px -5px var(--card-shadow), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
            overflow: hidden;
            border: 1px solid #f0f0f0;
            transition: transform 0.3s ease-in-out;
        }

        .container:hover {
            transform: translateY(-5px);
        }

        .header {
            background: linear-gradient(to right, var(--primary-color), var(--secondary-color));
            padding: 1.5rem;
            color: #fff;
            position: relative;
            overflow: hidden;
        }

        .header h1 {
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 0.25rem;
        }

        .header p {
            font-size: 0.875rem;
            color: rgba(255, 255, 255, 0.8);
        }

        .form-section {
            padding: 1.5rem;
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .form-group {
            display: flex;
            flex-direction: column;
            gap: 0.25rem;
        }

        .form-group label {
            color: var(--text-color);
            font-weight: 500;
        }

        .form-input, .form-select {
            width: 100%;
            padding: 0.75rem 1rem;
            border-radius: 0.5rem;
            border: 1px solid var(--border-color);
            transition: all 0.3s ease;
            font-family: 'Poppins', sans-serif;
            color: var(--text-color);
        }

        .form-input::placeholder {
            color: #a0aec0;
        }

        .form-input:focus, .form-select:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.2);
        }

        .grid-container {
            display: grid;
            grid-template-columns: repeat(2, minmax(0, 1fr));
            gap: 1rem;
        }

        .button-container {
            padding-top: 0.5rem;
        }

        .pay-button {
            width: 100%;
            background: linear-gradient(to right, var(--primary-color), var(--secondary-color));
            color: #fff;
            font-weight: 600;
            padding: 0.75rem 1rem;
            border-radius: 0.5rem;
            border: none;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .pay-button:hover {
            background: linear-gradient(to right, #4f46e5, #9333ea);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            transform: scale(1.01);
        }

        .pay-button:active {
            transform: scale(0.99);
        }

        .pay-button::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 300%;
            height: 300%;
            background: rgba(255, 255, 255, 0.15);
            transition: all 0.6s ease-out;
            border-radius: 50%;
            transform: translate(-50%, -50%) scale(0);
        }

        .pay-button:hover::before {
            transform: translate(-50%, -50%) scale(1);
        }
        
        @keyframes pulse {
            0%, 100% {
                transform: scale(1);
                box-shadow: 0 0 0 rgba(99, 102, 241, 0.7);
            }
            50% {
                transform: scale(1.02);
                box-shadow: 0 0 0 10px rgba(99, 102, 241, 0);
            }
        }
        .pay-button.animate-pulse {
            animation: pulse 2s infinite;
        }


        .info-icons {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.75rem;
            color: #718096;
            font-size: 0.875rem;
            margin-top: 1rem;
        }

        .info-icons svg {
            width: 1.25rem;
            height: 1.25rem;
        }

        .info-icons .secure-icon { color: #38a169; }
        .info-icons .instant-icon { color: #4299e1; }

        .footer {
            background-color: #1a202c;
            color: #fff;
            padding: 3rem;
        }

        .footer-grid {
            max-width: 72rem;
            margin: auto;
            display: grid;
            grid-template-columns: repeat(1, 1fr);
            gap: 2rem;
        }

        @media (min-width: 768px) {
            .footer-grid {
                grid-template-columns: repeat(3, 1fr);
            }
        }

        .footer h3 {
            font-size: 1.25rem;
            font-weight: 700;
            margin-bottom: 1rem;
        }

        .footer p {
            color: #a0aec0;
        }

        .footer-links h4 {
            font-weight: 700;
            margin-bottom: 1rem;
        }

        .footer-links ul {
            list-style: none;
            padding: 0;
            margin: 0;
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .footer-links a {
            color: #a0aec0;
            transition: color 0.3s;
        }

        .footer-links a:hover {
            color: #fff;
        }

        .footer-bottom {
            margin-top: 2rem;
            padding-top: 2rem;
            border-top: 1px solid #4a5568;
            text-align: center;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üéüÔ∏è Event Ticket Booking</h1>
            <p>Secure your spot at the most exciting event of the year!</p>
        </div>
        
        <div class="form-section">
            <div class="form-group">
                <label for="name">Full Name</label>
                <input id="name" class="form-input" placeholder="Enter your full name">
            </div>
            
            <div class="form-group">
                <label for="email">Email</label>
                <input id="email" type="email" class="form-input" placeholder="Enter you correct email">
            </div>
            
            <div class="grid-container">
                <div class="form-group">
                    <label for="mobile">Mobile</label>
                    <input id="mobile" type="tel" class="form-input" placeholder="9876543210">
                </div>
                
                <div class="form-group">
                    <label for="gender">Gender</label>
                    <select id="gender" class="form-select">
                        <option value="">Select</option>
                        <option>Male</option>
                        <option>Female</option>
                    </select>
                </div>
            </div>
            
            <div class="form-group">
                <label for="address">Address</label>
                <input id="address" class="form-input" placeholder="123 Main St, City">
            </div>
            
            <div class="button-container">
                <button id="payBtn" class="pay-button animate-pulse">
                    Pay & Book Now
                    <span class="ml-2">‚Üí</span>
                </button>
            </div>
            
            <div class="info-icons">
                <svg xmlns="http://www.w3.org/2000/svg" class="secure-icon" viewBox="0 0 20 20" fill="currentColor">
                    <path fill-rule="evenodd" d="M5 9V7a5 5 0 0110 0v2a2 2 0 012 2v5a2 2 0 01-2 2H5a2 2 0 01-2-2v-5a2 2 0 012-2zm8-2v2H7V7a3 3 0 016 0z" clip-rule="evenodd" />
                </svg>
                <span>Secure Payment</span>
                <span>‚Ä¢</span>
                <svg xmlns="http://www.w3.org/2000/svg" class="instant-icon" viewBox="0 0 20 20" fill="currentColor">
                    <path fill-rule="evenodd" d="M3 17a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm3.293-7.707a1 1 0 011.414 0L9 10.586V3a1 1 0 112 0v7.586l1.293-1.293a1 1 0 111.414 1.414l-3 3a1 1 0 01-1.414 0l-3-3a1 1 0 010-1.414z" clip-rule="evenodd" />
                </svg>
                <span>Instant Confirmation</span>
            </div>
        </div>

        <footer class="footer">
            <div class="footer-grid">
                <div>
                    <h3 class="footer-title">Make The Eve</h3>
                    <p>Making your special moments unforgettable.</p>
                </div>
                
                <div class="footer-links">
                    <h4>Quick Links</h4>
                    <ul>
                        <li><a href="index.html#events">Upcoming Events</a></li>
                        <li><a href="index.html#stars">Brighting Stars</a></li>
                        <li><a href="index.html#reviews">Reviews</a></li>
                        <li><a href="index.html#contact">Contact</a></li>
                    </ul>
                </div>
                
                <div class="footer-links">
                    <h4>Legal</h4>
                    <ul>
                        <li><a href="privacy_Policy.html">Privacy Policy</a></li>
                        <li><a href="contact_us.html">Contact Us</a></li>
                        <li><a href="refund_policy.html">Cancellation & Refund</a></li>
                        <li><a href="term&condition.html">Terms & Conditions</a></li>
                    </ul>
                </div>
            </div>
            
            <div class="footer-bottom">
                <p>&copy; 2025 Make The Eve. All rights reserved.</p>
            </div>
        </footer>
    </div>
    <script>
        // The previous code had a syntax error because the 'handler' function was defined twice
        // inside the Razorpay options object. This has been corrected.
        // The new code also uses a custom alert message box instead of the default `alert()`.
        
        // This function creates and shows a custom modal dialog
        function showMessage(message, type = "info") {
            const modal = document.createElement('div');
            modal.className = `modal-dialog modal-${type}`;
            modal.innerHTML = `
                <div class="modal-content">
                    <p class="modal-message">${message}</p>
                    <button class="modal-close-btn">OK</button>
                </div>
            `;
            document.body.appendChild(modal);

            const closeBtn = modal.querySelector('.modal-close-btn');
            closeBtn.onclick = () => {
                document.body.removeChild(modal);
            };
        }

  let RAZORPAY_KEY_ID = "";

  // Fetch public key from backend
  fetch("http://localhost:5000/get-razorpay-key")
    .then(res => res.json())
    .then(data => {
      RAZORPAY_KEY_ID = data.key;
      console.log("Loaded Razorpay Key:", RAZORPAY_KEY_ID);
    })
    .catch(err => console.error("Failed to load Razorpay key", err));


        document.getElementById("payBtn").addEventListener("click", async () => {
            const name = document.getElementById("name").value;
            const email = document.getElementById("email").value;
            const mobile = document.getElementById("mobile").value;
            const address = document.getElementById("address").value;
            const gender = document.getElementById("gender").value;

            if (!name || !email || !mobile || !address || !gender) {
                showMessage("Please fill all fields", "warning");
                return;
            }

            const payBtn = document.getElementById("payBtn");
            const originalBtnHtml = payBtn.innerHTML;

            // Show loading state
            payBtn.disabled = true;
            payBtn.innerHTML = 'Processing... <svg class="animate-spin -mr-1 ml-3 h-5 w-5 text-white inline-block" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg>';
            
            try {
                // 1Ô∏è‚É£ Create order
                const orderRes = await fetch("http://localhost:5000/create-order", {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ name, email, mobile, address, gender })
                });
                
                if (!orderRes.ok) {
                    throw new Error('Failed to create order');
                }
                
                const { order, bookingData } = await orderRes.json();

                // 2Ô∏è‚É£ Open Razorpay
                const options = {
                    key: RAZORPAY_KEY_ID,
                    amount: order.amount,
                    currency: order.currency,
                    name: "Event Booking",
                    description: `Booking for ${name}`,
                    order_id: order.id,
                    image: "./images/4.png", // Add your logo
                    theme: {
                        color: "#6366F1" // Indigo color
                    },
                    // The 'handler' function was duplicated, this is the corrected version
                    handler: async function (response) {
                        payBtn.innerHTML = 'Verifying Payment...';
                        
                        // 3Ô∏è‚É£ Verify payment
                        const verifyRes = await fetch("http://localhost:5000/verify-payment", {
                            method: "POST",
                            headers: { "Content-Type": "application/json" },
                            body: JSON.stringify({ response, bookingData })
                        });

                        // ‚úÖ Let server redirect to success.html
                        if (verifyRes.redirected) {
                            window.location.href = verifyRes.url;  // follow backend redirect
                        } else {
                            showMessage("Payment failed. Please try again.", "error");
                            payBtn.disabled = false;
                            payBtn.innerHTML = originalBtnHtml;
                        }
                    },
                    modal: {
                        ondismiss: function() {
                            payBtn.disabled = false;
                            payBtn.innerHTML = originalBtnHtml;
                        }
                    }
                };
                
                const rzp = new Razorpay(options);
                rzp.open();
                
            } catch (error) {
                console.error("Error:", error);
                showMessage("An error occurred. Please try again.", "error");
                payBtn.disabled = false;
                payBtn.innerHTML = originalBtnHtml;
            }
        });
    </script>
</body>
</html>
